{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///D:/tripplan/frontend/lib/firebaseClient.js"],"sourcesContent":["import { initializeApp, getApps } from 'firebase/app'\r\nimport { getAuth, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, signInWithEmailAndPassword } from 'firebase/auth'\r\n\r\nlet authInstance = null\r\n\r\nexport function initFirebase() {\r\n  if (getApps().length) return getAuth()\r\n  const config = {\r\n    apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\r\n    authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n    projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n  }\r\n  if (!config.apiKey) return null\r\n  const app = initializeApp(config)\r\n  authInstance = getAuth(app)\r\n  return authInstance\r\n}\r\n\r\nexport async function googleSignIn() {\r\n  const auth = authInstance || initFirebase()\r\n  if (!auth) throw new Error('Firebase not configured')\r\n  const provider = new GoogleAuthProvider()\r\n  // signInWithPopup returns a UserCredential; extract ID token for backend exchange\r\n  try {\r\n    const userCred = await signInWithPopup(auth, provider)\r\n    // Modern SDK: userCred.user.getIdToken() returns the Firebase ID token (JWT)\r\n    const idToken = await userCred.user.getIdToken()\r\n    return { user: userCred.user, idToken }\r\n  } catch (error) {\r\n    // Handle popup blocked or closed errors\r\n    if (error.code === 'auth/popup-closed-by-user' || error.code === 'auth/popup-blocked') {\r\n      throw new Error('Sign-in popup was closed or blocked. Please try again.')\r\n    }\r\n    throw error\r\n  }\r\n}\r\n\r\nexport async function exchangeFirebaseTokenWithBackend(idToken) {\r\n  const apiUrl = process.env.NEXT_PUBLIC_API_URL || ''\r\n  if (!apiUrl) throw new Error('NEXT_PUBLIC_API_URL not configured')\r\n  const resp = await fetch(`${apiUrl}/auth/firebase`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ id_token: idToken }),\r\n    // allow backend to set HttpOnly cookies\r\n    credentials: 'include'\r\n  })\r\n  if (!resp.ok) {\r\n    const text = await resp.text()\r\n    throw new Error(`Backend token exchange failed: ${resp.status} ${text}`)\r\n  }\r\n  return await resp.json()\r\n}\r\n\r\nexport function emailSignUp(email, password) {\r\n  const auth = authInstance || initFirebase()\r\n  if (!auth) throw new Error('Firebase not configured')\r\n  return createUserWithEmailAndPassword(auth, email, password)\r\n}\r\n\r\nexport function emailSignIn(email, password) {\r\n  const auth = authInstance || initFirebase()\r\n  if (!auth) throw new Error('Firebase not configured')\r\n  return signInWithEmailAndPassword(auth, email, password)\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;;;;;;AAEA,IAAI,eAAe;AAEZ,SAAS;IACd,IAAI,IAAA,yIAAO,IAAG,MAAM,EAAE,OAAO,IAAA,2IAAO;IACpC,MAAM,SAAS;QACb,MAAM;QACN,UAAU;QACV,SAAS;IACX;IACA,IAAI,CAAC,OAAO,MAAM,EAAE,OAAO;IAC3B,MAAM,MAAM,IAAA,+IAAa,EAAC;IAC1B,eAAe,IAAA,2IAAO,EAAC;IACvB,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,OAAO,gBAAgB;IAC7B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAC3B,MAAM,WAAW,IAAI,sJAAkB;IACvC,kFAAkF;IAClF,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,mJAAe,EAAC,MAAM;QAC7C,6EAA6E;QAC7E,MAAM,UAAU,MAAM,SAAS,IAAI,CAAC,UAAU;QAC9C,OAAO;YAAE,MAAM,SAAS,IAAI;YAAE;QAAQ;IACxC,EAAE,OAAO,OAAO;QACd,wCAAwC;QACxC,IAAI,MAAM,IAAI,KAAK,+BAA+B,MAAM,IAAI,KAAK,sBAAsB;YACrF,MAAM,IAAI,MAAM;QAClB;QACA,MAAM;IACR;AACF;AAEO,eAAe,iCAAiC,OAAO;IAC5D,MAAM,SAAS,6DAAmC;IAClD;;IACA,MAAM,OAAO,MAAM,MAAM,GAAG,OAAO,cAAc,CAAC,EAAE;QAClD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YAAE,UAAU;QAAQ;QACzC,wCAAwC;QACxC,aAAa;IACf;IACA,IAAI,CAAC,KAAK,EAAE,EAAE;QACZ,MAAM,OAAO,MAAM,KAAK,IAAI;QAC5B,MAAM,IAAI,MAAM,CAAC,+BAA+B,EAAE,KAAK,MAAM,CAAC,CAAC,EAAE,MAAM;IACzE;IACA,OAAO,MAAM,KAAK,IAAI;AACxB;AAEO,SAAS,YAAY,KAAK,EAAE,QAAQ;IACzC,MAAM,OAAO,gBAAgB;IAC7B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAC3B,OAAO,IAAA,kKAA8B,EAAC,MAAM,OAAO;AACrD;AAEO,SAAS,YAAY,KAAK,EAAE,QAAQ;IACzC,MAAM,OAAO,gBAAgB;IAC7B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAC3B,OAAO,IAAA,8JAA0B,EAAC,MAAM,OAAO;AACjD","debugId":null}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///D:/tripplan/frontend/pages/login.js"],"sourcesContent":["import { useState } from 'react'\r\nimport { initFirebase, googleSignIn, emailSignIn, emailSignUp, exchangeFirebaseTokenWithBackend } from '../lib/firebaseClient'\r\n\r\nexport default function Login() {\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [fullName, setFullName] = useState('')\r\n  const [msg, setMsg] = useState(null)\r\n  const apiUrl = process.env.NEXT_PUBLIC_API_URL || ''\r\n\r\n  const doGoogle = async () => {\r\n    try {\r\n      const res = await googleSignIn()\r\n      // res contains { user, idToken }\r\n      if (res && res.idToken) {\r\n        // exchange with backend to obtain app access token\r\n        const backendResp = await exchangeFirebaseTokenWithBackend(res.idToken)\r\n        // If backend returns an `access_token` store it as a fallback.\r\n        // Prefer backend-set HttpOnly cookie (no client storage) when the backend chooses that.\r\n        if (backendResp && backendResp.access_token) {\r\n          localStorage.setItem('access_token', backendResp.access_token)\r\n        }\r\n      }\r\n      // Redirect after sign-in; assume backend used HttpOnly cookie when no access_token was returned.\r\n      window.location.href = '/'\r\n    } catch (e) {\r\n      console.error(e)\r\n      setMsg('Google sign-in failed')\r\n    }\r\n  }\r\n\r\n  const doEmailSignUp = async () => {\r\n    // Call backend register endpoint\r\n    try {\r\n      const resp = await fetch(`${apiUrl}/auth/register`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email, password, full_name: fullName || '' }),\r\n        // include credentials to receive HttpOnly cookie if backend sets it\r\n        credentials: 'include'\r\n      })\r\n      if (!resp.ok) {\r\n        const txt = await resp.text()\r\n        throw new Error(`${resp.status} ${txt}`)\r\n      }\r\n      const data = await resp.json()\r\n      if (data && data.access_token) {\r\n        localStorage.setItem('access_token', data.access_token)\r\n        window.location.href = '/'\r\n        return\r\n      }\r\n      setMsg('Registration succeeded but no access token returned')\r\n    } catch (e) {\r\n      console.error(e)\r\n      setMsg('Sign up failed: ' + (e.message || e))\r\n    }\r\n  }\r\n\r\n  const doEmailSignIn = async () => {\r\n    // Call backend login endpoint\r\n    try {\r\n      const resp = await fetch(`${apiUrl}/auth/login`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email, password }),\r\n        // include credentials to receive HttpOnly cookie if backend sets it\r\n        credentials: 'include'\r\n      })\r\n      if (!resp.ok) {\r\n        const txt = await resp.text()\r\n        throw new Error(`${resp.status} ${txt}`)\r\n      }\r\n      const data = await resp.json()\r\n      if (data && data.access_token) {\r\n        localStorage.setItem('access_token', data.access_token)\r\n        window.location.href = '/'\r\n        return\r\n      }\r\n      setMsg('Login succeeded but no access token returned')\r\n    } catch (e) {\r\n      console.error(e)\r\n      setMsg('Sign in failed: ' + (e.message || e))\r\n    }\r\n  }\r\n\r\n  // initialize if configured\r\n  try { initFirebase() } catch(e) { /* ignore */ }\r\n\r\n  return (\r\n    <div style={{padding:20, maxWidth:640, margin:'0 auto'}}>\r\n      <h1>Login</h1>\r\n      {msg && <div style={{color:'red'}}>{msg}</div>}\r\n\r\n      <div style={{marginBottom:12}}>\r\n        <button onClick={doGoogle}>Sign in with Google</button>\r\n      </div>\r\n\r\n      <div style={{borderTop:'1px solid #eee', paddingTop:12}}>\r\n        <h3>Email / Password</h3>\r\n        <form onSubmit={(e) => { e.preventDefault(); doEmailSignIn(); }}>\r\n          <div>\r\n            <input placeholder=\"email\" type=\"email\" value={email} onChange={e=>setEmail(e.target.value)} style={{width:'100%'}} />\r\n          </div>\r\n          <div style={{marginTop:8}}>\r\n            <input placeholder=\"password\" type=\"password\" value={password} onChange={e=>setPassword(e.target.value)} style={{width:'100%'}} />\r\n          </div>\r\n          <div style={{marginTop:8}}>\r\n            <input placeholder=\"Full name (for sign up)\" value={fullName} onChange={e=>setFullName(e.target.value)} style={{width:'100%'}} />\r\n          </div>\r\n          <div style={{marginTop:8}}>\r\n            <button type=\"submit\">Sign in</button>\r\n            <button type=\"button\" onClick={doEmailSignUp} style={{marginLeft:8}}>Sign up</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}